% what is survival effect of reducing to one body length?

close all; clear all; clc

IndCd_ARKcases % run this to get amy's whales, their dimensions, their gear, everything else

% then change gear dimensions to be one body length
L = l;
lobs = []; % remove all lobster pots
flt = zeros(length(flt),1); % remove all floats

% get new expected gear
clear Rx
for ecase = 1:13
    Rx(ecase) =  TOWDRAGest_apply(ecase,L(ecase),D(ecase));
end

% no auxiliaries

% shortened theoretical drag
Rx_tot_short = Rx';

%% correct to measured drag
% relationship between measured and estimated drag
meas_short(flt == 0) = feval(FIT,Rx_tot_short(flt == 0),'0');

figure(1); clf; hold on
histogram(meas,[0:10:300])
histogram(meas_short,[0:5:300])

figure(2); clf; hold on
plot(zeros(length(meas),1),meas,'o')
plot(ones(length(meas),1),meas_short,'o')
for i = 1:length(meas)
    plot([0 1],[meas(i) meas_short(i)],'k')
end

xlim([-1 2])
ylabel('Dcorr; Corrected Drag Force (N)'); xlabel('Removal of most gear')

%% calculate shortened Dtot
Dtot_short = whaleDf + DI(:,8) + meas_short'; 

figure(3); clf; hold on
plot(zeros(length(Dtot),1),Dtot,'o')
plot(ones(length(Dtot),1),Dtot_short,'o')
for i = 1:length(Dtot)
    plot([0 1],[Dtot(i) Dtot_short(i)],'k')
end

xlim([-1 2])
ylabel('Total Whale Drag Force (N)'); xlabel('Removal of most gear')


%% power = (drag x speed)/efficiency
% entangled efficiency = 0.08
% nonentangled efficiency = 0.10
Pe = (Dtot*1.23)./0.08;
Pn = (whaleDf*1.23)./0.10;

[h,p,ci,stats] = ttest2(Pe,Pn);

d = 1:1:4000; % days

% how much energy for one day?
Wn = Pn*d*24*60*60; % J required for one day, not entangled
We = Pe*d*24*60*60; % J required for one day, entangled
Wa = We-Wn;

% for shortened gear:
Pe_short = (Dtot_short*1.23)./0.08;
We_short = Pe*d*24*60*60; % J required for one day, entangled
Wa_short = We_short-Wn;

% is shortened gear power significantly less than non-shortened?
[h,p,ci,stats] = ttest2(Pe,Pe_short); % NO

%% find days til minwork
for i = 1:13;
    daysmin(i) = min(find(Wa(i,:) > 1.86E10));
    daysmin_short(i) = min(find(Wa_short(i,:) > 1.86E10));
end

